---
title: "How to Setup the (STMB) for LUFA Development"
style:
lang: en
chapter :  
contents:
- Step 1 - Install AVR Toolchain
- Step 2 - Install DFU Programmer
- Step 3 - Install DFU Driver
- Step 4 - Install MinGW
- Step 5 - Install LUFA
- Step 6 - Compile & Execute HID Keyboard Demo 
---
## Introduction

![(STMB) Block Diagram](../begin/img/stemtera_breadboard_block_diagram.svg){: .three-quarter-w-w .center }

Inside the (STMB) there are two micro-controllers, ATmega328P and ATmega32U2. When operating in normal Arduino mode, the ATmega328P interacts with external devices and the ATmega32U2 act as a  TTL to USB converter. Both working together as an Arduino UNO board.

Since the IO pins of the ATmega32U2 are exposed on the tie points of the (STMB), we can fully utilize the IO pins of the ATmega32U2 and use it as an independent micro-controller. The ATmega32U2 is a very useful micro-controller for USB device development because of its native USB capability. 

There are 6 steps to get the LUFA environment installed:

1. Install AVR Toolchain
2. Install DFU Programmer
3. Install DFU Driver
4. Install MinGW
5. Install LUFA
6. Compile & Execute HID Keyboard Demo

In this guide, we will go through each of the steps in setting up the LUFA development environment for the ATmega32U2.   

## Step 1 - Install AVR Toolchain

In order to compile the source code of LUFA we need the AVR Toolchain from Atmel. The Atmel AVR 8-bit and 32-bit Toolchain 3.4.1 is recommended because this version has all the required tools.

Download the recommended AVR Toolchain from

[Atmel AVR 8-bit and 32-bit Toolchain 3.4.1](http://www.atmel.com/images/avr-toolchain-installer-3.4.1.1195-win32.win32.x86.exe)
{: .browser}

Once the download is completed, execute the EXE file and proceed with the installation. When asked to choose for features and folder, just click `Next` to proceed with the default selection.

![AVR Toolchain Installation Wizard](img/AVR_Toolchain_Install.svg){: .three-quarter-w-w .center }

After the installation is completed, type

`Win + r`
{: .keyboard }

In the open dialog box, type

`cmd`
{: .keyboard }

then click OK. A `Command Prompt` window will be displayed. On the `Command Prompt` window type,

`avr-gcc -v`
{: .keyboard }

You should see the `avr-gcc` enviroment settings and version number as below:

![avr-gcc command prompt screen](img/avr-gcc-v.svg){: .three-quarter-w-w  .center }

AVR Toolchain is now installed on your computer.
{: .success }

If you can't see similar result as above, the AVR Toolchain was not properly installed. Please try Step 1 again.
{: .info }

## Step 2 - Install DFU Programmer

`dfu-programmer` is a multi-platform command line programmer for Atmel micro-controllers with a USB Device Firmware Upgrade (DFU) bootloader. The ATmega32U2 inside the (STMB) comes pre-programmed with the USB DFU bootloader. 

Download the `dfu-programmer` from

[DFU Programmer 0.7.2](https://sourceforge.net/projects/dfu-programmer/files/dfu-programmer/0.7.2/dfu-programmer-win-0.7.2.zip/download)
{: .browser }

For Linux/Mac download the tar gz source for the `dfu-programmer` from [Linux/Mac DFU Programmer 0.7.2](https://sourceforge.net/projects/dfu-programmer/files/dfu-programmer/0.7.2/)
{: .info }

Once the download is completed, unzip the package to a temporary location. Copy `dfu-programmer.exe` to the `bin` folder of the AVR Toolchain (default AVR Toolchain's `bin` folder is at `C:\Program Files (x86)\Atmel\AVR Tools\AVR Toolchain\bin`)

![Copy dfu-programmer to bin of AVR Toolchain](img/dfu-copy.svg){: .full-w }

When copied correctly, you can see that the `dfu-programmer.exe` is in the same folder as the other tools like, `date.exe`, `dd.exe`, `df.exe`, `echo.exe` and etc.

`dfu-programmer` is now installed with the AVR Toolchain.
{: .success }

Do not remove the unzipped files of the `dfu-programmer`, we need it for the next step.
{: .warning }

## Step 3 - Install DFU Driver

When the ATmega32U2 of the (STMB) operates in DFU mode, it requires DFU driver to work properly. 


## Step 4 - Install MinGW
## Step 5 - Install LUFA
## Step 6 - Compile & Execute Keyboard Demo


